<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Completo - Firebase</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { color: #00ff00; text-align: center; }
        .warning {
            background: #ff6b00;
            color: #000;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-weight: bold;
            text-align: center;
        }
        .log {
            background: #000;
            padding: 1rem;
            border: 1px solid #00ff00;
            border-radius: 5px;
            height: 500px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .log div {
            margin: 0.5rem 0;
            font-size: 13px;
            line-height: 1.4;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning-text { color: #ffaa00; }
        .info { color: #00aaff; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 1.2rem 2.5rem;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            display: block;
            margin: 1rem auto;
            width: 100%;
            max-width: 400px;
        }
        button:hover {
            background: #00dd00;
        }
        button:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>üîß SETUP COMPLETO DO SISTEMA</h1>
    <div class="warning">
        ‚ö†Ô∏è Execute apenas UMA vez! Este script cria:<br>
        ‚Ä¢ 11 usu√°rios no Firebase Auth<br>
        ‚Ä¢ 10 minist√©rios com or√ßamentos na collection 'budgets'<br>
        ‚Ä¢ Collections vazias: proposals, notifications<br>
        ‚Ä¢ Regras de seguran√ßa do Firestore
    </div>
    
    <button id="btnSetup" onclick="setupComplete()">üöÄ INICIAR SETUP COMPLETO</button>
    
    <div class="log" id="log"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBLmX8UGHzmnMkLy16t3SwojA6u67lyvVA",
          authDomain: "governo-chocotone.firebaseapp.com",
          projectId: "governo-chocotone",
          storageBucket: "governo-chocotone.firebasestorage.app",
          messagingSenderId: "829728497507",
          appId: "1:829728497507:web:5689c0ad79c42dbe583d56",
          measurementId: "G-GR6CGD5WFP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const USERS = {
          'Chocotone': {
            email: 'chocotone@gov.br',
            password: 'GovChoco2025!',
            role: 'Presidenta',
            ministries: ['all'],
            habboUsername: 'Chocotone'
          },
          'Bryan dos Ouros': {
            email: 'bryan@gov.br',
            password: 'ViceGov2025#',
            role: 'Vice-Presidente',
            ministries: ['all'],
            habboUsername: 'bryandosouros'
          },
          '-Furia-': {
            email: 'furia@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Economia e Trabalho'],
            habboUsername: '-Furia-'
          },
          'joaobatistagc': {
            email: 'joao@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['Sa√∫de'],
            habboUsername: 'joaobatistagc'
          },
          'Stroch': {
            email: 'stroch@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Educa√ß√£o, Ci√™ncia e Tecnologia'],
            habboUsername: 'Stroch'
          },
          'Nyxalis': {
            email: 'nyxalis@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['Cidadania, Desenvolvimento Social, Direitos Humanos e Povos Origin√°rios'],
            habboUsername: 'Nyxalis'
          },
          'MalopRRN': {
            email: 'malop@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Defesa'],
            habboUsername: 'MalopRRN'
          },
          'guguinhoHop': {
            email: 'gugui@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Justi√ßa e Seguran√ßa P√∫blica'],
            habboUsername: 'guguinhoHop'
          },
          'Dj.Bigoreia': {
            email: 'bigoreia@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Infraestrutura'],
            habboUsername: 'Dj.Bigoreia'
          },
          'Fabio-Blunt-UK': {
            email: 'fabio@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Agricultura, Meio Ambiente, Turismo e Desenvolvimento Rural'],
            habboUsername: 'Fabio-Blunt-UK'
          },
          'Brenda.M': {
            email: 'brenda@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['Cultura e Esporte'],
            habboUsername: 'Brenda.M'
          },
          'Stallley': {
            email: 'stallley@gov.br',
            password: 'Ministro2025@',
            role: 'Advogado-Geral',
            ministries: [],
            habboUsername: 'Stallley'
          }
        };

        // OR√áAMENTOS CONFORME LEI OR√áAMENT√ÅRIA ANUAL (LEI 006/2025) - ANEXO I
        // Valores em reais (R$) - PLOA 01/2025
        const BUDGETS = [
          { ministry: 'Casa Civil', totalBudget: 57000000000, spent: 0 },  // R$ 57 bilh√µes (3%)
          { ministry: 'Economia e Trabalho', totalBudget: 342000000000, spent: 0 },  // R$ 342 bilh√µes (18%)
          { ministry: 'Sa√∫de', totalBudget: 247000000000, spent: 0 },  // R$ 247 bilh√µes (13%)
          { ministry: 'Educa√ß√£o, Ci√™ncia e Tecnologia', totalBudget: 266000000000, spent: 0 },  // R$ 266 bilh√µes (14%)
          { ministry: 'Cidadania, Desenvolvimento Social, Direitos Humanos e Povos Origin√°rios', totalBudget: 209000000000, spent: 0 },  // R$ 209 bilh√µes (11%)
          { ministry: 'Defesa', totalBudget: 95000000000, spent: 0 },  // R$ 95 bilh√µes (5%)
          { ministry: 'Justi√ßa e Seguran√ßa P√∫blica', totalBudget: 171000000000, spent: 0 },  // R$ 171 bilh√µes (9%)
          { ministry: 'Infraestrutura', totalBudget: 190000000000, spent: 0 },  // R$ 190 bilh√µes (10%)
          { ministry: 'Agricultura, Meio Ambiente, Turismo e Desenvolvimento Rural', totalBudget: 95000000000, spent: 0 },  // R$ 95 bilh√µes (5%)
          { ministry: 'Cultura e Esporte', totalBudget: 76000000000, spent: 0 },  // R$ 76 bilh√µes (4%)
          { ministry: 'Advocacia-Geral da Uni√£o', totalBudget: 38000000000, spent: 0 }  // R$ 38 bilh√µes (2%)
        ];

        function log(message, type = 'success') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.setupComplete = async function() {
            const btn = document.getElementById('btnSetup');
            btn.disabled = true;
            
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('üöÄ INICIANDO SETUP COMPLETO DO SISTEMA', 'info');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('', 'success');
            
            let usersSuccess = 0;
            let usersError = 0;
            let adminUid = null;

            // ==== PASSO 1: CRIAR USU√ÅRIOS ====
            log('üìù PASSO 1/3: Criando usu√°rios no Firebase Auth...', 'warning-text');
            log('', 'success');

            for (const [name, userData] of Object.entries(USERS)) {
                try {
                    log(`  ‚è≥ Criando: ${name} (${userData.email})...`, 'info');
                    
                    const userCredential = await createUserWithEmailAndPassword(
                        auth, 
                        userData.email, 
                        userData.password
                    );
                    
                    const uid = userCredential.user.uid;
                    
                    // Salvar UID da Presidenta para usar depois
                    if (name === 'Chocotone') {
                        adminUid = uid;
                    }
                    
                    await setDoc(doc(db, 'users', uid), {
                        name: name,
                        email: userData.email,
                        role: userData.role,
                        ministries: userData.ministries,
                        habboUsername: userData.habboUsername,
                        createdAt: new Date().toISOString()
                    });
                    
                    log(`  ‚úÖ ${name} criado! UID: ${uid.substring(0, 8)}...`, 'success');
                    usersSuccess++;
                    
                    await auth.signOut();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        log(`  ‚ö†Ô∏è ${name} j√° existe`, 'warning-text');
                        // Se Chocotone j√° existe, pegar UID dela
                        if (name === 'Chocotone') {
                            try {
                                const cred = await signInWithEmailAndPassword(auth, userData.email, userData.password);
                                adminUid = cred.user.uid;
                                log(`  ‚ÑπÔ∏è UID da Presidenta obtido para criar or√ßamentos`, 'info');
                            } catch (e) {
                                log(`  ‚ùå Erro ao obter UID: ${e.message}`, 'error');
                            }
                        }
                    } else {
                        log(`  ‚ùå Erro em ${name}: ${error.message}`, 'error');
                        usersError++;
                    }
                }
            }
            
            log('', 'success');
            log(`‚úÖ Usu√°rios: ${usersSuccess} criados | ${usersError} erros`, 'success');
            log('', 'success');

            // ==== PASSO 2: FAZER LOGIN E CRIAR OR√áAMENTOS ====
            log('üí∞ PASSO 2/3: Criando or√ßamentos dos minist√©rios...', 'warning-text');
            log('  ‚ÑπÔ∏è Fazendo login como Presidenta para ter permiss√µes...', 'info');
            log('', 'success');

            // Fazer login com a Presidenta
            try {
                await signInWithEmailAndPassword(auth, 'chocotone@gov.br', 'GovChoco2025!');
                log('  ‚úÖ Login como Presidenta realizado!', 'success');
                log('', 'success');
            } catch (error) {
                log(`  ‚ùå Erro ao fazer login: ${error.message}`, 'error');
                log('  ‚ö†Ô∏è Imposs√≠vel criar or√ßamentos sem estar logado', 'warning-text');
                btn.textContent = '‚úì SETUP CONCLU√çDO (COM ERROS)';
                btn.style.background = '#ff6b00';
                return;
            }

            let budgetsSuccess = 0;

            for (const budget of BUDGETS) {
                try {
                    const docId = budget.ministry.replace(/[^a-zA-Z0-9]/g, '_');
                    
                    await setDoc(doc(db, 'budgets', docId), {
                        ministry: budget.ministry,
                        totalBudget: budget.totalBudget,
                        spent: budget.spent,
                        available: budget.totalBudget - budget.spent,
                        lastUpdated: new Date().toISOString()
                    });
                    
                    log(`  ‚úÖ ${budget.ministry}: R$ ${(budget.totalBudget / 1000000000).toFixed(1)} bilh√µes`, 'success');
                    budgetsSuccess++;
                    
                } catch (error) {
                    log(`  ‚ùå Erro: ${budget.ministry} - ${error.message}`, 'error');
                }
            }

            log('', 'success');
            log(`‚úÖ Or√ßamentos: ${budgetsSuccess}/${BUDGETS.length} criados`, 'success');
            log('', 'success');

            // ==== PASSO 3: INICIALIZAR COLLECTIONS ====
            log('ÔøΩ PASSO 3/3: Inicializando collections do sistema...', 'warning-text');
            log('', 'success');

            try {
                // Criar documento inicial placeholder para proposals
                await setDoc(doc(db, 'proposals', '_init'), {
                    placeholder: true,
                    message: 'Collection criada - Propostas aparecer√£o aqui',
                    createdAt: new Date().toISOString()
                });
                log('  ‚úÖ Collection "proposals" inicializada', 'success');

                // Criar documento inicial placeholder para notifications
                await setDoc(doc(db, 'notifications', '_init'), {
                    placeholder: true,
                    message: 'Collection criada - Notifica√ß√µes aparecer√£o aqui',
                    createdAt: new Date().toISOString()
                });
                log('  ‚úÖ Collection "notifications" inicializada', 'success');

            } catch (error) {
                log(`  ‚ùå Erro ao criar collections: ${error.message}`, 'error');
            }

            log('', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('üéâ SETUP CONCLU√çDO COM SUCESSO!', 'success');
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
            log('', 'success');
            log('üìä RESUMO:', 'info');
            log(`   ‚Ä¢ Usu√°rios criados: ${usersSuccess}`, 'info');
            log(`   ‚Ä¢ Or√ßamentos configurados: ${budgetsSuccess}`, 'info');
            log(`   ‚Ä¢ Collections inicializadas: 4 (users, budgets, proposals, notifications)`, 'info');
            log('', 'success');
            log('‚úÖ Sistema pronto para uso!', 'success');
            log('‚û°Ô∏è  Volte para index.html e fa√ßa login', 'warning-text');
            log('', 'success');
            
            btn.textContent = '‚úì SETUP CONCLU√çDO';
            btn.style.background = '#555';
        };

        log('‚úÖ Firebase inicializado e pronto', 'success');
        log('‚ö†Ô∏è Clique no bot√£o para iniciar o setup', 'warning-text');
    </script>
</body>
</html>
