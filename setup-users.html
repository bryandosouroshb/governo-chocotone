<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Setup Completo - Firebase</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            padding: 2rem;
            max-width: 900px;
            margin: 0 auto;
        }
        h1 { color: #00ff00; text-align: center; }
        .warning {
            background: #ff6b00;
            color: #000;
            padding: 1rem;
            border-radius: 5px;
            margin: 1rem 0;
            font-weight: bold;
            text-align: center;
        }
        .log {
            background: #000;
            padding: 1rem;
            border: 1px solid #00ff00;
            border-radius: 5px;
            height: 500px;
            overflow-y: auto;
            margin: 1rem 0;
        }
        .log div {
            margin: 0.5rem 0;
            font-size: 13px;
            line-height: 1.4;
        }
        .success { color: #00ff00; }
        .error { color: #ff0000; }
        .warning-text { color: #ffaa00; }
        .info { color: #00aaff; }
        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 1.2rem 2.5rem;
            font-size: 1.1rem;
            cursor: pointer;
            font-weight: bold;
            border-radius: 8px;
            display: block;
            margin: 1rem auto;
            width: 100%;
            max-width: 400px;
        }
        button:hover {
            background: #00dd00;
        }
        button:disabled {
            background: #555;
            color: #999;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ SETUP COMPLETO DO SISTEMA</h1>
    <div class="warning">
        âš ï¸ Execute apenas UMA vez! Este script cria:<br>
        â€¢ 11 usuÃ¡rios no Firebase Auth<br>
        â€¢ 10 ministÃ©rios com orÃ§amentos na collection 'budgets'<br>
        â€¢ Collections vazias: proposals, notifications<br>
        â€¢ Regras de seguranÃ§a do Firestore
    </div>
    
    <button id="btnSetup" onclick="setupComplete()">ğŸš€ INICIAR SETUP COMPLETO</button>
    
    <div class="log" id="log"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, setDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
          apiKey: "AIzaSyBLmX8UGHzmnMkLy16t3SwojA6u67lyvVA",
          authDomain: "governo-chocotone.firebaseapp.com",
          projectId: "governo-chocotone",
          storageBucket: "governo-chocotone.firebasestorage.app",
          messagingSenderId: "829728497507",
          appId: "1:829728497507:web:5689c0ad79c42dbe583d56",
          measurementId: "G-GR6CGD5WFP"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const USERS = {
          'Chocotone': {
            email: 'chocotone@gov.br',
            password: 'GovChoco2025!',
            role: 'Presidenta',
            ministries: ['all']
          },
          'Bryan dos Ouros': {
            email: 'bryan@gov.br',
            password: 'ViceGov2025#',
            role: 'Vice-Presidente',
            ministries: ['all']
          },
          '-Furia-': {
            email: 'furia@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Economia e Trabalho']
          },
          'joaobatistagc': {
            email: 'joao@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['SaÃºde']
          },
          'Stroch': {
            email: 'stroch@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['EducaÃ§Ã£o, CiÃªncia e Tecnologia']
          },
          'Nyxalis': {
            email: 'nyxalis@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['Cidadania, Desenvolvimento Social, Direitos Humanos e Povos OriginÃ¡rios']
          },
          'MalopRRN': {
            email: 'malop@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Defesa']
          },
          'guguinhoHop': {
            email: 'gugui@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['JustiÃ§a e SeguranÃ§a PÃºblica']
          },
          'Dj.Bigoreia': {
            email: 'bigoreia@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Infraestrutura']
          },
          'Fabio-Blunt-UK': {
            email: 'fabio@gov.br',
            password: 'Ministro2025@',
            role: 'Ministro',
            ministries: ['Agricultura, Meio Ambiente, Turismo e Desenvolvimento Rural']
          },
          'Brenda.M': {
            email: 'brenda@gov.br',
            password: 'Ministro2025@',
            role: 'Ministra',
            ministries: ['Cultura e Esporte']
          },
          'Stallley': {
            email: 'stallley@gov.br',
            password: 'Ministro2025@',
            role: 'Advogado-Geral',
            ministries: ['Advocacia-Geral da UniÃ£o']
          }
        };

        const BUDGETS = [
          { ministry: 'Economia e Trabalho', totalBudget: 5000000, spent: 0 },
          { ministry: 'SaÃºde', totalBudget: 10000000, spent: 0 },
          { ministry: 'EducaÃ§Ã£o, CiÃªncia e Tecnologia', totalBudget: 8000000, spent: 0 },
          { ministry: 'Cidadania, Desenvolvimento Social, Direitos Humanos e Povos OriginÃ¡rios', totalBudget: 6000000, spent: 0 },
          { ministry: 'Defesa', totalBudget: 12000000, spent: 0 },
          { ministry: 'JustiÃ§a e SeguranÃ§a PÃºblica', totalBudget: 7000000, spent: 0 },
          { ministry: 'Infraestrutura', totalBudget: 15000000, spent: 0 },
          { ministry: 'Agricultura, Meio Ambiente, Turismo e Desenvolvimento Rural', totalBudget: 9000000, spent: 0 },
          { ministry: 'Cultura e Esporte', totalBudget: 4000000, spent: 0 },
          { ministry: 'Advocacia-Geral da UniÃ£o', totalBudget: 3000000, spent: 0 }
        ];

        function log(message, type = 'success') {
            const logDiv = document.getElementById('log');
            const entry = document.createElement('div');
            entry.className = type;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            logDiv.appendChild(entry);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        window.setupComplete = async function() {
            const btn = document.getElementById('btnSetup');
            btn.disabled = true;
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('ğŸš€ INICIANDO SETUP COMPLETO DO SISTEMA', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('', 'success');
            
            let usersSuccess = 0;
            let usersError = 0;

            // ==== PASSO 1: CRIAR USUÃRIOS ====
            log('ğŸ“ PASSO 1/3: Criando usuÃ¡rios no Firebase Auth...', 'warning-text');
            log('', 'success');

            for (const [name, userData] of Object.entries(USERS)) {
                try {
                    log(`  â³ Criando: ${name} (${userData.email})...`, 'info');
                    
                    const userCredential = await createUserWithEmailAndPassword(
                        auth, 
                        userData.email, 
                        userData.password
                    );
                    
                    const uid = userCredential.user.uid;
                    
                    await setDoc(doc(db, 'users', uid), {
                        name: name,
                        email: userData.email,
                        role: userData.role,
                        ministries: userData.ministries,
                        createdAt: new Date().toISOString()
                    });
                    
                    log(`  âœ… ${name} criado! UID: ${uid.substring(0, 8)}...`, 'success');
                    usersSuccess++;
                    
                    await auth.signOut();
                    await new Promise(resolve => setTimeout(resolve, 300));
                    
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        log(`  âš ï¸ ${name} jÃ¡ existe`, 'warning-text');
                    } else {
                        log(`  âŒ Erro em ${name}: ${error.message}`, 'error');
                        usersError++;
                    }
                }
            }
            
            log('', 'success');
            log(`âœ… UsuÃ¡rios: ${usersSuccess} criados | ${usersError} erros`, 'success');
            log('', 'success');

            // ==== PASSO 2: CRIAR ORÃ‡AMENTOS ====
            log('ğŸ’° PASSO 2/3: Criando orÃ§amentos dos ministÃ©rios...', 'warning-text');
            log('', 'success');

            let budgetsSuccess = 0;

            for (const budget of BUDGETS) {
                try {
                    const docId = budget.ministry.replace(/[^a-zA-Z0-9]/g, '_');
                    
                    await setDoc(doc(db, 'budgets', docId), {
                        ministry: budget.ministry,
                        totalBudget: budget.totalBudget,
                        spent: budget.spent,
                        available: budget.totalBudget - budget.spent,
                        lastUpdated: new Date().toISOString()
                    });
                    
                    log(`  âœ… ${budget.ministry}: R$ ${(budget.totalBudget / 1000000).toFixed(1)}M`, 'success');
                    budgetsSuccess++;
                    
                } catch (error) {
                    log(`  âŒ Erro: ${budget.ministry} - ${error.message}`, 'error');
                }
            }

            log('', 'success');
            log(`âœ… OrÃ§amentos: ${budgetsSuccess}/${BUDGETS.length} criados`, 'success');
            log('', 'success');

            // ==== PASSO 3: INICIALIZAR COLLECTIONS ====
            log('ï¿½ PASSO 3/3: Inicializando collections do sistema...', 'warning-text');
            log('', 'success');

            try {
                // Criar documento inicial placeholder para proposals
                await setDoc(doc(db, 'proposals', '_init'), {
                    placeholder: true,
                    message: 'Collection criada - Propostas aparecerÃ£o aqui',
                    createdAt: new Date().toISOString()
                });
                log('  âœ… Collection "proposals" inicializada', 'success');

                // Criar documento inicial placeholder para notifications
                await setDoc(doc(db, 'notifications', '_init'), {
                    placeholder: true,
                    message: 'Collection criada - NotificaÃ§Ãµes aparecerÃ£o aqui',
                    createdAt: new Date().toISOString()
                });
                log('  âœ… Collection "notifications" inicializada', 'success');

            } catch (error) {
                log(`  âŒ Erro ao criar collections: ${error.message}`, 'error');
            }

            log('', 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
            log('ğŸ‰ SETUP CONCLUÃDO COM SUCESSO!', 'success');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'success');
            log('', 'success');
            log('ğŸ“Š RESUMO:', 'info');
            log(`   â€¢ UsuÃ¡rios criados: ${usersSuccess}`, 'info');
            log(`   â€¢ OrÃ§amentos configurados: ${budgetsSuccess}`, 'info');
            log(`   â€¢ Collections inicializadas: 4 (users, budgets, proposals, notifications)`, 'info');
            log('', 'success');
            log('âœ… Sistema pronto para uso!', 'success');
            log('â¡ï¸  Volte para index.html e faÃ§a login', 'warning-text');
            log('', 'success');
            
            btn.textContent = 'âœ“ SETUP CONCLUÃDO';
            btn.style.background = '#555';
        };

        log('âœ… Firebase inicializado e pronto', 'success');
        log('âš ï¸ Clique no botÃ£o para iniciar o setup', 'warning-text');
    </script>
</body>
</html>
